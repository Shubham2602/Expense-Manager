{"ast":null,"code":"const _require = require('assert'),\n      assert = _require.strict;\n\nconst _require2 = require('crypto'),\n      signOneShot = _require2.sign,\n      verifyOneShot = _require2.verify,\n      createSign = _require2.createSign,\n      createVerify = _require2.createVerify;\n\nconst _require3 = require('../help/ecdsa_signatures'),\n      derToJose = _require3.derToJose,\n      joseToDer = _require3.joseToDer;\n\nconst _require4 = require('../help/consts'),\n      KEYOBJECT = _require4.KEYOBJECT;\n\nconst resolveNodeAlg = require('../help/node_alg');\n\nconst _require5 = require('../help/key_object'),\n      asInput = _require5.asInput;\n\nconst _require6 = require('../help/runtime_support'),\n      dsaEncodingSupported = _require6.dsaEncodingSupported;\n\nlet sign, verify;\n\nif (dsaEncodingSupported) {\n  // >= 13.2.0\n  sign = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload) => {\n    return signOneShot(nodeAlg, payload, {\n      key: asInput(keyObject, false),\n      dsaEncoding: 'ieee-p1363'\n    });\n  };\n} else if (signOneShot) {\n  // >= 12.0.0\n  sign = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload) => {\n    return derToJose(signOneShot(nodeAlg, payload, asInput(keyObject, false)), jwaAlg);\n  };\n} else {\n  sign = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload) => {\n    return derToJose(createSign(nodeAlg).update(payload).sign(asInput(keyObject, false)), jwaAlg);\n  };\n}\n\nif (dsaEncodingSupported) {\n  // >= 13.2.0\n  verify = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload, signature) => {\n    try {\n      return verifyOneShot(nodeAlg, payload, {\n        key: asInput(keyObject, true),\n        dsaEncoding: 'ieee-p1363'\n      }, signature);\n    } catch (err) {\n      return false;\n    }\n  };\n} else if (verifyOneShot) {\n  // >= 12.0.0\n  verify = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload, signature) => {\n    try {\n      return verifyOneShot(nodeAlg, payload, asInput(keyObject, true), joseToDer(signature, jwaAlg));\n    } catch (err) {\n      return false;\n    }\n  };\n} else {\n  verify = (jwaAlg, nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload, signature) => {\n    try {\n      return createVerify(nodeAlg).update(payload).verify(asInput(keyObject, true), joseToDer(signature, jwaAlg));\n    } catch (err) {\n      return false;\n    }\n  };\n}\n\nmodule.exports = JWA => {\n  ['ES256', 'ES384', 'ES512', 'ES256K'].forEach(jwaAlg => {\n    const nodeAlg = resolveNodeAlg(jwaAlg);\n    assert(!JWA.sign.has(jwaAlg), \"sign alg \".concat(jwaAlg, \" already registered\"));\n    assert(!JWA.verify.has(jwaAlg), \"verify alg \".concat(jwaAlg, \" already registered\"));\n    JWA.sign.set(jwaAlg, sign.bind(undefined, jwaAlg, nodeAlg));\n    JWA.verify.set(jwaAlg, verify.bind(undefined, jwaAlg, nodeAlg));\n  });\n};","map":null,"metadata":{},"sourceType":"script"}