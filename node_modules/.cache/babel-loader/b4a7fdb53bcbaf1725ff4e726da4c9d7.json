{"ast":null,"code":"const _require = require('assert'),\n      assert = _require.strict;\n\nconst _require2 = require('crypto'),\n      signOneShot = _require2.sign,\n      verifyOneShot = _require2.verify,\n      createSign = _require2.createSign,\n      createVerify = _require2.createVerify,\n      constants = _require2.constants;\n\nconst _require3 = require('../help/consts'),\n      KEYOBJECT = _require3.KEYOBJECT;\n\nconst resolveNodeAlg = require('../help/node_alg');\n\nconst _require4 = require('../help/key_object'),\n      asInput = _require4.asInput;\n\nlet sign, verify;\n\nif (signOneShot) {\n  sign = (nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload) => {\n    return signOneShot(nodeAlg, payload, {\n      key: asInput(keyObject, false),\n      padding: constants.RSA_PKCS1_PSS_PADDING,\n      saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n    });\n  };\n} else {\n  sign = (nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload) => {\n    const key = asInput(keyObject, false);\n    return createSign(nodeAlg).update(payload).sign({\n      key,\n      padding: constants.RSA_PKCS1_PSS_PADDING,\n      saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n    });\n  };\n}\n\nif (verifyOneShot) {\n  verify = (nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload, signature) => {\n    return verifyOneShot(nodeAlg, payload, {\n      key: asInput(keyObject, false),\n      padding: constants.RSA_PKCS1_PSS_PADDING,\n      saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n    }, signature);\n  };\n} else {\n  verify = (nodeAlg, {\n    [KEYOBJECT]: keyObject\n  }, payload, signature) => {\n    const key = asInput(keyObject, true);\n    return createVerify(nodeAlg).update(payload).verify({\n      key,\n      padding: constants.RSA_PKCS1_PSS_PADDING,\n      saltLength: constants.RSA_PSS_SALTLEN_DIGEST\n    }, signature);\n  };\n}\n\nmodule.exports = JWA => {\n  ['PS256', 'PS384', 'PS512'].forEach(jwaAlg => {\n    const nodeAlg = resolveNodeAlg(jwaAlg);\n    assert(!JWA.sign.has(jwaAlg), \"sign alg \".concat(jwaAlg, \" already registered\"));\n    assert(!JWA.verify.has(jwaAlg), \"verify alg \".concat(jwaAlg, \" already registered\"));\n    JWA.sign.set(jwaAlg, sign.bind(undefined, nodeAlg));\n    JWA.verify.set(jwaAlg, verify.bind(undefined, nodeAlg));\n  });\n};","map":null,"metadata":{},"sourceType":"script"}